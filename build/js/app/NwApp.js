OJ.importJs("nw.app.NwSession");OJ.importJs("nw.window.NwWindowManager");OJ.importJs("nw.net.NwUrlLoader");OJ.importJs("nw.net.NwUrlRequest");OJ.importJs("nw.utils.NwCacheManager");OJ.importJs("oj.nav.OjView");OJ.importJs("oj.events.OjMouseEvent");OJ.importJs("oj.fx.OjFade");OJ.importJs("oj.fx.OjResize");OJ.importJs("oj.fx.OjTweenEvent");OJ.importJs("oj.fx.OjTweenSet");OJ.importJs("oj.net.OjRpc");OJ.importCss("nw.app.NwApp");"use strict";OJ.extendClass(OjView,"NwApp",{_get_props_:{maxWidth:null,maxHeight:null,minWidth:320,minHeight:320,session:null,systemBar:"appSystemBarDefault",url:null},_api_endpoint:"/",_api_request_type:OjUrlRequest.QUERY_STRING,_api_response_type:null,_has_mobile_layout:false,_has_tablet_layout:false,_is_logged_in:false,_orientations:null,_ready:false,_scale:1,_timer:null,_acl:null,_constructor:function(){this._super("NwApp","_constructor",arguments);var a=HistoryManager.get();this._url=a.getProtocol()+"://"+a.getHost();if((OJ.isMobile()&&this._has_mobile_layout)||(OJ.isTablet()&&this._has_tablet_layout)){this.setSystemBar(NwApp.SYSTEM_BAR_DEFAULT);this._scale=OJ.getPixelRatio();OJ.meta("viewport","width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no");OJ.meta("apple-mobile-web-app-capable","yes")}if(this._orientations){NW.setSupportedOrientations(this._orientations)}if(this._minWidth&&this._minHeight){NW.setMinSize(this._minWidth,this._minHeight)}if(this._maxWidth&&this._maxHeight){NW.setMaxSize(this._maxWidth,this._maxHeight)}this._acl={}},_buildApiUrl:function(a){return this._api_endpoint+String.string(a)},_login:function(){this._is_logged_in=true;this.dispatchEvent(new OjEvent(NwApp.LOGIN));AppManager.dispatchEvent(new OjEvent(NwApp.LOGIN))},_loginFail:function(){this._is_logged_in=false;this.dispatchEvent(new OjEvent(NwApp.LOGIN_FAIL));AppManager.dispatchEvent(new OjEvent(NwApp.LOGIN_FAIL))},_logout:function(){this._is_logged_in=false;this.dispatchEvent(new OjEvent(NwApp.LOGOUT));AppManager.dispatchEvent(new OjEvent(NwApp.LOGOUT))},_logoutFail:function(){this.dispatchEvent(new OjEvent(NwApp.LOGOUT_FAIL));AppManager.dispatchEvent(new OjEvent(NwApp.LOGOUT_FAIL))},_makeSession:function(){return new NwSession()},_onSaveSession:function(a){CacheManager.setData(this.className(),this._session)},_onSessionChange:function(a){this._timer.restart()},apiRequest:function(d,c){var b=arguments.length;var a=new NwUrlLoader(new NwUrlRequest(this._buildApiUrl(d),c,this._api_request_type,b>2?arguments[2]:OjUrlRequest.GET),b>3?arguments[3]:true);a.setContentType(this._api_response_type);return a},hideLoading:function(){return this._hideOverlay()},init:function(){if(!(this._session=CacheManager.getData(this.className()))){this._session=this._makeSession()}this._timer=new OjTimer(500,1);this._timer.addEventListener(OjTimer.COMPLETE,this,"_onSaveSession");this._session.addEventListener(OjEvent.CHANGE,this,"_onSessionChange");this.redraw();return this._session},isLoggedIn:function(){return this._is_logged_in},login:function(){},logout:function(){},showLoading:function(){return this._showOverlay.apply(this,arguments)},setSystemBar:function(b){this._systemBar=b;if(NwApp.OS==NwApp.IOS){var a;switch(this._systemBar){case NwApp.SYSTEM_BAR_BLACK:a="black";break;case NwApp.SYSTEM_BAR_BLACK_NONE:case NwApp.SYSTEM_BAR_BLACK_TRANS:a="black-translucent";break;default:a="default";break}OJ.meta("apple-mobile-web-app-status-bar-style",a)}}},{LOGIN:"onLogin",LOGIN_FAIL:"onLoginFail",LOGOUT:"onLogout",LOGOUT_FAIL:"onLogoutFail",SYSTEM_BAR_BLACK:"appSystemBarBlack",SYSTEM_BAR_BLACK_TRANS:"appSystemBarBlackTranslucent",SYSTEM_BAR_DEFAULT:"appSystemBarDefault",SYSTEM_BAR_NONE:"appSystemBarNone"});