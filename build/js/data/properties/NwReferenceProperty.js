OJ.importJs("nw.data.NwData");OJ.importJs("nw.data.NwDataEvent");OJ.importJs("nw.data.properties.NwObjectProperty");OJ.importJs("oj.data.OjCollection");"use strict";OJ.extendClass(NwObjectProperty,"NwReferenceProperty",{_props_:{"class":NwData,allowNesting:false},_constructor:function(a){this._super("NwReferenceProperty","_constructor",arguments.length>1?[arguments[1]]:[]);this.setClass(a)},_exportSubValue:function(b,a,c){if(b&&isObjective(b)){return(this._allowNesting||this._flatten)?b.exportData(c):b.primaryKey()}return b},_exportValue:function(d,a,e){if(this._max==1){return this._exportSubValue(d,a,e)}var b=[],c=d?d.numItems():0;for(;c--;){b.unshift(this._exportSubValue(d.getItemAt(c),a,e))}return b},_formatter:function(b,c){var a=arguments.length;return b.call(this,c,a>2?arguments[2]:null,a>3?arguments[3]:NwData.DEFAULT)},_importSubValue:function(c,b,d){if(!c){return null}if(isObjective(c)&&c.is(this._class)){return c}if((this._allowNesting||this._flatten)&&b){if(isObject(c)){b.importData(c,d)}else{b.primaryKey(c)}return b}var a=this.getClass();return isObject(c)?a.importData(c,d):a.get(c)},_importValue:function(f,b,h){if(this._max==1){return this._importSubValue(f,b,h)}var g=b?b.numItems():0,a=g?b:new OjCollection();if(isArray(f)){var e=isArray(f)?f.length:0;e=this._max==0?e:Math.min(e,this._max);for(;e--;){if(e<g){a.setItemAt(this._importSubValue(f[e],a.getItemAt(e),h),e)}else{a.addItemAt(this._importSubValue(f[e],null,h),g)}}return a}if(isObject(f)){var d,c;for(d in f){c=parseInt(d);if(!this._max||ary.length<this._max){if(c<g){a.setItemAt(this._importSubValue(f[d],a.getItemAt(c),h),c)}else{a.addItem(this._importSubValue(f[d],null,h))}}}return a}return(this._allowNesting||this._flatten)?b:null},setup:function(c,h,i){this._name=h;if(!this._namespace){this._namespace=h}var f="get"+i,b="set"+i,g=this._namespace.ucFirst(),e,d=(this._allowNesting||this._flatten);e="on"+g+"Change";if(!c[e]){c[e]=function(j){if(d){this._addToDirty(h)}}}if(!c[f]){c[f]=function(){return this.property(h)}}if(!c[b]){c[b]=function(k){var j=this.property(h);if(j){if(j.is("NwData")){j.removeEventListener(NwDataEvent.CHANGE,this,e)}else{if(j.is("OjCollection")){j.removeEventListener(OjCollectionEvent.ITEM_ADD,this,e);j.removeEventListener(OjCollectionEvent.ITEM_MOVE,this,e);j.removeEventListener(OjCollectionEvent.ITEM_REMOVE,this,e);j.removeEventListener(OjCollectionEvent.ITEM_REPLACE,this,e)}}}this.property(h,k);if(k){if(k.is("NwData")){k.addEventListener(NwDataEvent.CHANGE,this,e)}else{if(k.is("OjCollection")){k.addEventListener(OjCollectionEvent.ITEM_ADD,this,e);k.addEventListener(OjCollectionEvent.ITEM_MOVE,this,e);k.addEventListener(OjCollectionEvent.ITEM_REMOVE,this,e);k.addEventListener(OjCollectionEvent.ITEM_REPLACE,this,e)}}}}}if(this._max==1||!this._namespace){return}var a;a="add"+g;if(!c[a]){c[a]=function(k){var j=this.property(h);if(!j){this.property(h,j=new OjCollection())}if(d){k.addEventListener(NwDataEvent.CHANGE,this,e)}this._addToDirty(h);return j.addItem(k)}}a+="At";if(!c[a]){c[a]=function(l,k){var j=this.property(h);if(!j){this.property(h,j=new OjCollection())}if(d){l.addEventListener(NwDataEvent.CHANGE,this,e)}this._addToDirty(h);return j.addItemAt(l,k)}}a="get"+g+"At";if(!c[a]){c[a]=function(k){var j=this.property(h);if(!j){return null}return j.getItemAt(k)}}a="has"+g;if(!c[a]){c[a]=function(k){var j=this.property(h);return j?j.hasItem(k):false}}a="indexOf"+g;if(!c[a]){c[a]=function(k){var j=this.property(h);return j?j.indexOfItem(k):-1}}a="num"+OJ.pluralize(g);if(!c[a]){c[a]=function(){var j=this.property(h);return j?j.numItems():0}}a="remove"+g;if(!c[a]){c[a]=function(k){var j=this.property(h);if(!j){return k}if(d){k.removeEventListener(NwDataEvent.CHANGE,this,e)}this._addToDirty(h);return j.removeItem(k)}}a+="At";if(!c[a]){c[a]=function(k){var j=this.property(h);if(!j){return null}if(d){item.removeEventListener(NwDataEvent.CHANGE,this,e)}this._addToDirty(h);return j.removeItemAt(k)}}},getClass:function(){return OJ.toClass(this._class)}});